	# SPECTRUM KERNEL MANAGER
# Ramdisk file for profile based kernel management
# Implimentation inspired by Franco's fku profiles

on init
    # Create Power HAL tunables
    mkdir /dev/voxpopuli 0555 system system

on boot
    # Set Power HAL tunables
    write /dev/voxpopuli/enable_interaction_boost   1
    write /dev/voxpopuli/fling_min_boost_duration   200
    write /dev/voxpopuli/fling_max_boost_duration   2500
    write /dev/voxpopuli/fling_boost_topapp         10
    write /dev/voxpopuli/fling_min_freq_big         1113
    write /dev/voxpopuli/fling_min_freq_little      1113
    write /dev/voxpopuli/touch_boost_duration       200
    write /dev/voxpopuli/touch_boost_topapp         5
    write /dev/voxpopuli/touch_min_freq_big         1036
    write /dev/voxpopuli/touch_min_freq_little      1036
    write /dev/voxpopuli/launch_boost_duration      2500
    write /dev/voxpopuli/launch_boost_topapp         10
    write /dev/voxpopuli/launch_min_freq_big         1500
    write /dev/voxpopuli/launch_min_freq_little      1300	
    chmod 0644 /dev/voxpopuli/enable_interaction_boost
    chmod 0644 /dev/voxpopuli/fling_min_boost_duration
    chmod 0644 /dev/voxpopuli/fling_max_boost_duration
    chmod 0644 /dev/voxpopuli/fling_boost_topapp
    chmod 0644 /dev/voxpopuli/fling_min_freq_big
    chmod 0644 /dev/voxpopuli/fling_min_freq_little
    chmod 0644 /dev/voxpopuli/touch_boost_duration
    chmod 0644 /dev/voxpopuli/touch_boost_topapp
    chmod 0644 /dev/voxpopuli/touch_min_freq_big
    chmod 0644 /dev/voxpopuli/touch_min_freq_little
    chmod 0644 /dev/voxpopuli/launch_boost_duration
    chmod 0644 /dev/voxpopuli/launch_boost_topapp
    chmod 0644 /dev/voxpopuli/launch_min_freq_big
    chmod 0644 /dev/voxpopuli/launch_min_freq_little  	
    chown system system /dev/voxpopuli/enable_interaction_boost
    chown system system /dev/voxpopuli/fling_min_boost_duration
    chown system system /dev/voxpopuli/fling_max_boost_duration
    chown system system /dev/voxpopuli/fling_boost_topapp      
    chown system system /dev/voxpopuli/fling_min_freq_big      
    chown system system /dev/voxpopuli/fling_min_freq_little   
    chown system system /dev/voxpopuli/touch_boost_duration    
    chown system system /dev/voxpopuli/touch_boost_topapp      
    chown system system /dev/voxpopuli/touch_min_freq_big      
    chown system system /dev/voxpopuli/touch_min_freq_little
    chown system system /dev/voxpopuli/launch_boost_duration
    chown system system /dev/voxpopuli/launch_boost_topapp
    chown system system /dev/voxpopuli/launch_min_freq_big
    chown system system /dev/voxpopuli/launch_min_freq_little 
	
   #Create PERFD deamon related dirs
   mkdir /data/misc/perfd 0755 root system
   chmod 2755 /data/misc/perfd
   mkdir /data/system/perfd 0770 root system
   rm /data/system/perfd/default_values
   chmod 2770 /data/system/perfd


   #Create IOP deamon related dirs
   mkdir /data/misc/iop 0770 root system

service perfd /vendor/bin/perfd
   class main
   user root
   group root readproc
   disabled
   socket perfd seqpacket 0666 root system
   writepid /dev/cpuset/system-background/tasks

service iop /vendor/bin/iop
    class main
    user root
    group root
    disabled
    socket iop seqpacket 0666 root system
    writepid /dev/cpuset/system-background/tasks

service energy-awareness /vendor/bin/energy-awareness
    class main
    user root
    group system
    oneshot

service msm_irqbalance /vendor/bin/msm_irqbalance -f /vendor/etc/msm_irqbalance.conf
    class main
    user root
    group root
    disabled
    writepid /dev/cpuset/system-background/tasks

#Spectrum Initialization
on property:sys.boot_completed=1
   start profile-sh
   start msm_irqbalance
   start energy-awareness
   start thermal-engine
   start qfp-daemon
   start iop
   start perfd
   # Enable Spectrum support
   setprop spectrum.support 1
   # Add kernel name
   setprop persist.spectrum.kernel Aex

    # update cpusets now that boot is complete and we want better load balancing
    write /dev/cpuset/top-app/cpus 0-3
    write /dev/cpuset/foreground/cpus 0-2
    write /dev/cpuset/background/cpus 0
    write /dev/cpuset/system-background/cpus 0-2

# Balance (default profile)
on property:persist.spectrum.profile=0

    write /dev/voxpopuli/enable_interaction_boost   "1"
    write /dev/voxpopuli/fling_min_boost_duration   "250"
    write /dev/voxpopuli/fling_max_boost_duration   "1000"
    write /dev/voxpopuli/fling_boost_topapp         "10"
    write /dev/voxpopuli/fling_min_freq_big         "1036"
    write /dev/voxpopuli/fling_min_freq_little      "1036"
    write /dev/voxpopuli/touch_boost_duration       "250"
    write /dev/voxpopuli/touch_boost_topapp         "0"
    write /dev/voxpopuli/touch_min_freq_big         "800"
    write /dev/voxpopuli/touch_min_freq_little      "800"
    write /dev/voxpopuli/launch_boost_duration       1000
    write /dev/voxpopuli/launch_boost_topapp         0
    write /dev/voxpopuli/launch_min_freq_big         1500
    write /dev/voxpopuli/launch_min_freq_little      1300		
    write /sys/devices/system/cpu/cpu0/cpufreq/scaling_governor "schedutil"
    write /sys/devices/system/cpu/cpu2/cpufreq/scaling_governor "schedutil"
    write /sys/devices/system/cpu/cpu0/cpufreq/schedutil/down_rate_limit_us 5000
    write /sys/devices/system/cpu/cpu0/cpufreq/schedutil/up_rate_limit_us 500
    write /sys/devices/system/cpu/cpu2/cpufreq/schedutil/down_rate_limit_us 5000
    write /sys/devices/system/cpu/cpu2/cpufreq/schedutil/up_rate_limit_us 500
	
    # Input-Boost
    write /sys/module/cpu_boost/parameters/input_boost_enabled 1
    write /sys/module/cpu_boost/parameters/input_boost_freq "0:844800 2:691200"
    write /sys/module/cpu_boost/parameters/input_boost_ms 80
    write /sys/module/cpu_boost/parameters/dynamic_stune_boost 10
    write /sys/module/cpu_boost/parameters/dynamic_stune_boost_ms 300
	
    # Set idle GPU to 133 MHz
    write /sys/class/kgsl/kgsl-3d0/default_pwrlevel 6
    write /sys/class/kgsl/kgsl-3d0/max_pwrlevel 0
    write /sys/class/kgsl/kgsl-3d0/devfreq/adrenoboost 0
    write /sys/devices/soc/b00000.qcom,kgsl-3d0/kgsl/kgsl-3d0/min_clock_mhz 133
    write /sys/class/kgsl/kgsl-3d0/devfreq/min_freq 133000000
    write /sys/devices/soc/b00000.qcom,kgsl-3d0/kgsl/kgsl-3d0/max_clock_mhz 624
    write /sys/class/kgsl/kgsl-3d0/devfreq/max_freq 624000000

	write /proc/sys/net/ipv4/tcp_congestion_control "westwood"
	
    start thermal-engine

# Performance (based on DrunkSauce Lite)
on property:persist.spectrum.profile=1

     # Set high performance settings

    write /sys/class/devfreq/soc:qcom,cpubw/governor "bw_hwmon"
    write /sys/class/kgsl/kgsl-3d0/devfreq/governor "msm-adreno-tz"

    write /sys/module/cpu_boost/parameters/input_boost_freq 0:1324800
    write /sys/module/cpu_boost/parameters/input_boost_freq 1:0
    write /sys/module/cpu_boost/parameters/input_boost_freq 2:1324800
    write /sys/module/cpu_boost/parameters/input_boost_freq 3:0
    write /sys/module/cpu_boost/parameters/input_boost_ms 40

    # Set idle GPU to 133 MHz
    write /sys/class/kgsl/kgsl-3d0/default_pwrlevel 6
    write /sys/class/kgsl/kgsl-3d0/max_pwrlevel 0
    write /sys/class/kgsl/kgsl-3d0/devfreq/adrenoboost 3
    write /sys/devices/soc/b00000.qcom,kgsl-3d0/kgsl/kgsl-3d0/min_clock_mhz 401
    write /sys/class/kgsl/kgsl-3d0/devfreq/min_freq 401000000
    write /sys/devices/soc/b00000.qcom,kgsl-3d0/kgsl/kgsl-3d0/max_clock_mhz 624
    write /sys/class/kgsl/kgsl-3d0/devfreq/max_freq 624000000
    write /dev/voxpopuli/enable_interaction_boost   "1"
    write /dev/voxpopuli/fling_min_boost_duration   "500"
    write /dev/voxpopuli/fling_max_boost_duration   "3500"
    write /dev/voxpopuli/fling_boost_topapp         "10"
    write /dev/voxpopuli/fling_min_freq_big         "1113"
    write /dev/voxpopuli/fling_min_freq_little      "1113"
    write /dev/voxpopuli/touch_boost_duration       "500"
    write /dev/voxpopuli/touch_boost_topapp         "5"
    write /dev/voxpopuli/touch_min_freq_big         "1113"
    write /dev/voxpopuli/touch_min_freq_little      "1113"
    write /dev/voxpopuli/launch_boost_duration       2500
    write /dev/voxpopuli/launch_boost_topapp         10
    write /dev/voxpopuli/launch_min_freq_big         2100
    write /dev/voxpopuli/launch_min_freq_little      1500	
    write /sys/devices/system/cpu/cpu0/cpufreq/scaling_governor "schedutil"
    write /sys/devices/system/cpu/cpu2/cpufreq/scaling_governor "schedutil"
    write /sys/devices/system/cpu/cpu0/cpufreq/schedutil/down_rate_limit_us 5000
    write /sys/devices/system/cpu/cpu0/cpufreq/schedutil/up_rate_limit_us 500
    write /sys/devices/system/cpu/cpu2/cpufreq/schedutil/down_rate_limit_us 5000
    write /sys/devices/system/cpu/cpu2/cpufreq/schedutil/up_rate_limit_us 500
	write /proc/sys/net/ipv4/tcp_congestion_control "westwood"

    start thermal-engine

# Battery
on property:persist.spectrum.profile=2
	 
    write /dev/voxpopuli/enable_interaction_boost   "1"
    write /dev/voxpopuli/fling_min_boost_duration   "200"
    write /dev/voxpopuli/fling_max_boost_duration   "500"
    write /dev/voxpopuli/fling_boost_topapp         "0"
    write /dev/voxpopuli/fling_min_freq_big         "500"
    write /dev/voxpopuli/fling_min_freq_little      "500"
    write /dev/voxpopuli/touch_boost_duration       "100"
    write /dev/voxpopuli/touch_boost_topapp         "0"
    write /dev/voxpopuli/touch_min_freq_big         "600"
    write /dev/voxpopuli/touch_min_freq_little      "600"
    write /dev/voxpopuli/launch_boost_duration       2500
    write /dev/voxpopuli/launch_boost_topapp         10
    write /dev/voxpopuli/launch_min_freq_big         2100
    write /dev/voxpopuli/launch_min_freq_little      1500		
    write /sys/devices/system/cpu/cpu0/cpufreq/scaling_governor "schedutil"
    write /sys/devices/system/cpu/cpu2/cpufreq/scaling_governor "schedutil"
    write /sys/devices/system/cpu/cpu0/cpufreq/schedutil/down_rate_limit_us 500
    write /sys/devices/system/cpu/cpu0/cpufreq/schedutil/up_rate_limit_us 2000
    write /sys/devices/system/cpu/cpu2/cpufreq/schedutil/down_rate_limit_us 500
    write /sys/devices/system/cpu/cpu2/cpufreq/schedutil/up_rate_limit_us 2000
    write /sys/module/cpu_boost/parameters/input_boost_freq 0:307200
    write /sys/module/cpu_boost/parameters/input_boost_freq 1:0
    write /sys/module/cpu_boost/parameters/input_boost_freq 2:307200
    write /sys/module/cpu_boost/parameters/input_boost_freq 3:0
    write /sys/module/cpu_boost/parameters/input_boost_ms 10

    # Set idle GPU to 133 MHz
    write /sys/class/kgsl/kgsl-3d0/default_pwrlevel 6
    write /sys/class/kgsl/kgsl-3d0/max_pwrlevel 0
    write /sys/class/kgsl/kgsl-3d0/devfreq/adrenoboost 0
    write /sys/devices/soc/b00000.qcom,kgsl-3d0/kgsl/kgsl-3d0/min_clock_mhz 133
    write /sys/class/kgsl/kgsl-3d0/devfreq/min_freq 133000000
    write /sys/devices/soc/b00000.qcom,kgsl-3d0/kgsl/kgsl-3d0/max_clock_mhz 624
    write /sys/class/kgsl/kgsl-3d0/devfreq/max_freq 624000000
	
     write /sys/class/devfreq/soc:qcom,cpubw/governor "powersave"
     write /sys/class/kgsl/kgsl-3d0/devfreq/governor  "powersave"

	write /proc/sys/net/ipv4/tcp_congestion_control "westwood"
	

	
# Gaming
on property:persist.spectrum.profile=3
    # Add configs here
     # Set high performance settings
	 
    write /dev/voxpopuli/enable_interaction_boost   "1"
    write /dev/voxpopuli/fling_min_boost_duration   "500"
    write /dev/voxpopuli/fling_max_boost_duration   "3500"
    write /dev/voxpopuli/fling_boost_topapp         "10"
    write /dev/voxpopuli/fling_min_freq_big         "1113"
    write /dev/voxpopuli/fling_min_freq_little      "1113"
    write /dev/voxpopuli/touch_boost_duration       "500"
    write /dev/voxpopuli/touch_boost_topapp         "5"
    write /dev/voxpopuli/touch_min_freq_big         "1113"
    write /dev/voxpopuli/touch_min_freq_little      "1113"
    write /dev/voxpopuli/launch_boost_duration       2500
    write /dev/voxpopuli/launch_boost_topapp         10
    write /dev/voxpopuli/launch_min_freq_big         2100
    write /dev/voxpopuli/launch_min_freq_little      1500		
    write /sys/devices/system/cpu/cpu0/cpufreq/scaling_governor "schedutil"
    write /sys/devices/system/cpu/cpu2/cpufreq/scaling_governor "schedutil"
    write /sys/devices/system/cpu/cpu0/cpufreq/schedutil/down_rate_limit_us 5000
    write /sys/devices/system/cpu/cpu0/cpufreq/schedutil/up_rate_limit_us 500
    write /sys/devices/system/cpu/cpu2/cpufreq/schedutil/down_rate_limit_us 5000
    write /sys/devices/system/cpu/cpu2/cpufreq/schedutil/up_rate_limit_us 500
	 
    write /sys/class/devfreq/soc:qcom,cpubw/governor "bw_hwmon"
    write /sys/class/kgsl/kgsl-3d0/devfreq/governor "msm-adreno-tz"
	 

    # Set idle GPU to 133 MHz
    write /sys/class/kgsl/kgsl-3d0/default_pwrlevel 6
    write /sys/class/kgsl/kgsl-3d0/max_pwrlevel 0
    write /sys/class/kgsl/kgsl-3d0/devfreq/adrenoboost 3
    write /sys/devices/soc/b00000.qcom,kgsl-3d0/kgsl/kgsl-3d0/min_clock_mhz 315
    write /sys/class/kgsl/kgsl-3d0/devfreq/min_freq 315000000
    write /sys/devices/soc/b00000.qcom,kgsl-3d0/kgsl/kgsl-3d0/max_clock_mhz 624
    write /sys/class/kgsl/kgsl-3d0/devfreq/max_freq 624000000		
	

    # Input-Boost
    write /sys/module/cpu_boost/parameters/input_boost_enabled 1
    write /sys/module/cpu_boost/parameters/input_boost_freq "0:1132800 2:1056000"
    write /sys/module/cpu_boost/parameters/input_boost_ms 1000

	write /proc/sys/net/ipv4/tcp_congestion_control "westwood"

       start perf-hal-1-0
       start thermal-engine

# Gaming
on property:persist.spectrum.profile=4
   	start qcom-post-boot
	
    write /dev/voxpopuli/enable_interaction_boost   "1"
    write /dev/voxpopuli/fling_min_boost_duration   "250"
    write /dev/voxpopuli/fling_max_boost_duration   "2500"
    write /dev/voxpopuli/fling_boost_topapp         "10"
    write /dev/voxpopuli/fling_min_freq_big         "1036"
    write /dev/voxpopuli/fling_min_freq_little      "1036"
    write /dev/voxpopuli/touch_boost_duration       "250"
    write /dev/voxpopuli/touch_boost_topapp         "0"
    write /dev/voxpopuli/touch_min_freq_big         "1036"
    write /dev/voxpopuli/touch_min_freq_little      "1036"
    write /sys/devices/system/cpu/cpu0/cpufreq/scaling_governor "schedutil"
    write /sys/devices/system/cpu/cpu2/cpufreq/scaling_governor "schedutil"
    write /sys/devices/system/cpu/cpu0/cpufreq/schedutil/down_rate_limit_us 5000
    write /sys/devices/system/cpu/cpu0/cpufreq/schedutil/up_rate_limit_us 500
    write /sys/devices/system/cpu/cpu2/cpufreq/schedutil/down_rate_limit_us 5000
    write /sys/devices/system/cpu/cpu2/cpufreq/schedutil/up_rate_limit_us 500

    # Set idle GPU to 133 MHz
    write /sys/class/kgsl/kgsl-3d0/default_pwrlevel 6
    write /sys/class/kgsl/kgsl-3d0/max_pwrlevel 0
    write /sys/class/kgsl/kgsl-3d0/devfreq/adrenoboost 0
    write /sys/devices/soc/b00000.qcom,kgsl-3d0/kgsl/kgsl-3d0/min_clock_mhz 133
    write /sys/class/kgsl/kgsl-3d0/devfreq/min_freq 133000000
    write /sys/devices/soc/b00000.qcom,kgsl-3d0/kgsl/kgsl-3d0/max_clock_mhz 624
    write /sys/class/kgsl/kgsl-3d0/devfreq/max_freq 624000000


#Default
on property:thermal.profile=0
    setprop sys.qcom.thermalcfg "/vendor/etc/thermal-engine-default.conf"
    stop thermal-engine
    start thermal-engine

#Game
on property:thermal.profile=9
    setprop sys.qcom.thermalcfg "/vendor/etc/thermal-engine-game.conf"
    stop thermal-engine
    start thermal-engine

#Performance
on property:thermal.profile=10
    setprop sys.qcom.thermalcfg "/vendor/etc/thermal-engine-default.conf"
    stop thermal-engine
    start thermal-engine

#Video
on property:thermal.profile=14
    setprop sys.qcom.thermalcfg "/vendor/etc/thermal-engine-video.conf"
    stop thermal-engine
    start thermal-engine

#Video
on property:thermal.profile=13
    setprop sys.qcom.thermalcfg "/vendor/etc/thermal-engine-game.conf"
    stop thermal-engine
    start thermal-engine

#Video
on property:thermal.profile=11
    setprop sys.qcom.thermalcfg "/vendor/etc/thermal-engine-default.conf"
    stop thermal-engine
    start thermal-engine


